# Staged: src/app/api/reports/file/route.ts

```
{"status":"success","output":"import { NextResponse } from \"next/server\";\nimport fs from \"fs\";\nimport path from \"path\";\nimport { withAuth } from \"@/lib/auth-server\";\n\nconst REPOS_BASE_DIR = process.env.REPOS_DIR || \"/home/ubuntu/dokodemodoor/repos\";\n\nexport async function GET(req: Request) {\n  try {\n    const { searchParams } = new URL(req.url);\n    const relPath = searchParams.get(\"path\");\n    if (!relPath) return NextResponse.json({ error: \"Missing path\" }, { status: 400 });\n\n    const fullPath = path.join(REPOS_BASE_DIR, relPath);\n    if (!fullPath.startsWith(REPOS_BASE_DIR)) {\n      return NextResponse.json({ error: \"Invalid path\" }, { status: 403 });\n    }\n\n    // Auth Check\n    const { errorResponse } = await withAuth(['ADMIN', 'SECURITY']);\n    if (errorResponse) return errorResponse;\n\n    if (!fs.existsSync(fullPath) || fs.lstatSync(fullPath).isDirectory()) {\n      return NextResponse.json({ error: \"File not found\" }, { status: 404 });\n    }\n\n    const content = fs.readFileSync(fullPath, \"utf-8\");\n    return NextResponse.json({ content });\n  } catch (err) {\n    console.error(\"Report file GET error:\", err);\n    return NextResponse.json({ error: \"Internal Server Error\" }, { status: 500 });\n  }\n}\n\nexport async function POST(req: Request) {\n  try {\n    const { path: relPath, content } = await req.json();\n    if (!relPath) return NextResponse.json({ error: \"Missing path\" }, { status: 400 });\n\n    const fullPath = path.join(REPOS_BASE_DIR, relPath);\n    if (!fullPath.startsWith(REPOS_BASE_DIR)) {\n      return NextResponse.json({ error: \"Invalid path\" }, { status: 403 });\n    }\n\n    // Auth Check\n    const { errorResponse } = await withAuth(['ADMIN', 'SECURITY']);\n    if (errorResponse) return errorResponse;\n\n    fs.writeFileSync(fullPath, content, \"utf-8\");\n    return NextResponse.json({ message: \"Saved successfully\" });\n  } catch (err) {\n    console.error(\"Report file POST error:\", err);\n    return NextResponse.json({ error: \"Internal Server Error\" }, { status: 500 });\n  }\n}\n\nexport async function DELETE(req: Request) {\n  try {\n    const { searchParams } = new URL(req.url);\n    const relPath = searchParams.get(\"path\");\n    if (!relPath) return NextResponse.json({ error: \"Missing path\" }, { status: 400 });\n\n    const fullPath = path.join(REPOS_BASE_DIR, relPath);\n    if (!fullPath.startsWith(REPOS_BASE_DIR)) {\n      return NextResponse.json({ error: \"Invalid path\" }, { status: 403 });\n    }\n\n    // Role Check\n    const { errorResponse } = await withAuth(['ADMIN', 'SECURITY']);\n    if (errorResponse) return errorResponse;\n\n    if (!fs.existsSync(fullPath)) {\n      return NextResponse.json({ error: \"Path not found\" }, { status: 404 });\n    }\n\n    // Recursive delete\n    fs.rmSync(fullPath, { recursive: true, force: true });\n\n    return NextResponse.json({ message: \"Deleted successfully\" });\n  } catch (err) {\n    console.error(\"Delete report error:\", err);\n    return NextResponse.json({ error: \"Internal Server Error\" }, { status: 500 });\n  }\n}","exitCode":0}
```