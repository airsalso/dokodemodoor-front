# Staged: src/components/Terminal.tsx

```
{"status":"success","output":"\"use client\";\n\nimport { useEffect, useMemo, useRef } from \"react\";\nimport { Terminal as XTerm, type ITerminalOptions } from \"@xterm/xterm\";\nimport { FitAddon } from \"@xterm/addon-fit\";\nimport \"@xterm/xterm/css/xterm.css\";\nimport { useLanguage } from \"@/context/LanguageContext\";\nimport { TERMINAL_THEMES } from \"@/constants/terminalThemes\";\n\ninterface TerminalProps {\n  logs: string[];\n}\n\nexport function Terminal({ logs }: TerminalProps) {\n  const { terminalTheme, terminalFont } = useLanguage();\n  const terminalRef = useRef<HTMLDivElement>(null);\n  const xtermRef = useRef<XTerm | null>(null);\n  const lastLogIndex = useRef(0);\n\n  // Determine current theme with a rock-solid fallback\n  const currentTheme = useMemo(\n    () => TERMINAL_THEMES[terminalTheme] || TERMINAL_THEMES.bright,\n    [terminalTheme]\n  );\n  const logsRef = useRef<string[]>(logs);\n\n  useEffect(() => {\n    logsRef.current = logs;\n  }, [logs]);\n\n  useEffect(() => {\n    if (!terminalRef.current) return;\n\n    // Clean start: remove any existing terminal DOM elements\n    terminalRef.current.innerHTML = \"\";\n\n    const theme = TERMINAL_THEMES[terminalTheme] || TERMINAL_THEMES.bright;\n    const termOptions: ITerminalOptions = {\n      cursorBlink: true,\n      fontSize: 14,\n      fontWeight: \"400\", // Force normal weight\n      fontWeightBold: \"400\", // Force bold codes to render as normal to prevent distortion\n      fontFamily: `${terminalFont ? `${terminalFont}, ` : \"\"}'JetBrains Mono', 'Fira Code', 'DejaVu Sans Mono', 'Courier New', monospace`,\n      theme,\n      convertEol: true,\n      allowTransparency: false,\n      lineHeight: 1.0,\n      letterSpacing: 0,\n      allowProposedApi: true, // Enable advanced features like customGlyphs\n      customGlyphs: true,\n      scrollback: parseInt(process.env.NEXT_PUBLIC_TERMINAL_SCROLLBACK_LINES || \"10000\"),\n    };\n    const term = new XTerm(termOptions);\n\n    const fitAddon = new FitAddon();\n    term.loadAddon(fitAddon);\n    term.open(terminalRef.current);\n\n    // Write all existing logs immediately\n    term.clear();\n    for (const log of logsRef.current) {\n      term.write(log);\n    }\n    lastLogIndex.current = logsRef.current.length;\n    xtermRef.current = term;\n\n    // Force fit after a short delay, and another one once fonts are definitely loaded\n    const timeout = setTimeout(() => {\n      try {\n        fitAddon.fit();\n      } catch (e) {\n        console.error(\"Fit error:\", e);\n      }\n    }, 200);\n\n    const fontTimeout = setTimeout(() => {\n      try {\n        fitAddon.fit();\n      } catch {}\n    }, 1000);\n\n    const handleResize = () => {\n      try {\n        fitAddon.fit();\n      } catch {}\n    };\n    window.addEventListener(\"resize\", handleResize);\n\n    return () => {\n      window.removeEventListener(\"resize\", handleResize);\n      clearTimeout(timeout);\n      clearTimeout(fontTimeout);\n      term.dispose();\n      xtermRef.current = null;\n    };\n  }, [terminalTheme, terminalFont]); // Remount on theme or font change\n\n  // Stream incoming logs\n  useEffect(() => {\n    if (xtermRef.current && logs.length > lastLogIndex.current) {\n      for (let i = lastLogIndex.current; i < logs.length; i++) {\n        xtermRef.current.write(logs[i]);\n      }\n      lastLogIndex.current = logs.length;\n    }\n    else if (xtermRef.current && logs.length < lastLogIndex.current) {\n      xtermRef.current.clear();\n      for (const log of logs) {\n        xtermRef.current.write(log);\n      }\n      lastLogIndex.current = logs.length;\n    }\n  }, [logs]);\n\n  return (\n    <div\n      className=\"w-full h-full min-h-[500px] flex flex-col\"\n      style={{\n        backgroundColor: currentTheme.background,\n        color: currentTheme.foreground\n      }}\n    >\n      <div\n        ref={terminalRef}\n        className=\"w-full h-full flex-1 p-4\"\n        style={{ backgroundColor: currentTheme.background }}\n      />\n    </div>\n  );\n}","exitCode":0}
```